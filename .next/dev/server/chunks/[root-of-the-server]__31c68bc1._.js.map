{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sil/Documents/Reposit%C3%B3rios/paodequeijodaira/src/pages/api/checkout-mp.js"],"sourcesContent":["import { MercadoPagoConfig, Preference } from 'mercadopago';\r\n\r\n// 1. Configuração do Cliente com seu Access Token\r\n// IMPORTANTE: Adicione MP_ACCESS_TOKEN no seu arquivo .env.local\r\nconst client = new MercadoPagoConfig({ \r\n  accessToken: process.env.MP_ACCESS_TOKEN \r\n});\r\n\r\nexport default async function handler(req, res) {\r\n  // Garantir que apenas requisições POST sejam aceitas\r\n  if (req.method !== 'POST') {\r\n    return res.status(405).json({ message: 'Método não permitido' });\r\n  }\r\n\r\n  const { itens, total, cpf, email, endereco } = req.body;\r\n\r\n  try {\r\n    const preference = new Preference(client);\r\n\r\n    // 2. Criar a estrutura da preferência\r\n    const response = await preference.create({\r\n      body: {\r\n        // Mapeia os itens do carrinho para o formato do Mercado Pago\r\n        items: itens.map(item => ({\r\n          id: item.id.toString(),\r\n          title: item.nome,\r\n          unit_price: Number(item.preco),\r\n          quantity: Number(item.quantidade),\r\n          currency_id: 'BRL'\r\n        })),\r\n        \r\n        // Dados do comprador (ajuda na aprovação do antifraude)\r\n        payer: {\r\n          email: email || \"comprador@email.com\",\r\n          identification: {\r\n            type: 'CPF',\r\n            number: cpf.replace(/\\D/g, '') // Remove pontos e traços do CPF\r\n          }\r\n        },\r\n\r\n        // URLs de retorno que criamos anteriormente\r\n        back_urls: {\r\n          success: \"https://paodequeijodaira.vercel.app/sucesso\",\r\n          failure: \"https://paodequeijodaira.vercel.app/erro\",\r\n          pending: \"https://paodequeijodaira.vercel.app/sucesso\",\r\n        },\r\n        \r\n        // Redireciona automaticamente após o sucesso\r\n        auto_return: \"approved\",\r\n\r\n        // Metadados para você identificar o pedido no seu banco depois\r\n        metadata: {\r\n          id_referencia: `pedido_${Date.now()}`,\r\n          endereco_entrega: endereco\r\n        },\r\n\r\n        // Métodos de pagamento permitidos (opcional)\r\n        payment_methods: {\r\n          excluded_payment_types: [], // Pode excluir boleto se quiser apenas Pix/Cartão\r\n          installments: 12, // Máximo de parcelas\r\n        },\r\n      }\r\n    });\r\n\r\n    // 3. Retornar os dados do checkout para o frontend\r\n    // O 'init_point' é o link oficial do checkout do Mercado Pago\r\n    res.status(200).json({ \r\n      id: response.id, \r\n      init_point: response.init_point \r\n    });\r\n\r\n  } catch (error) {\r\n    console.error(\"Erro no Mercado Pago:\", error);\r\n    res.status(500).json({ \r\n      error: \"Erro ao processar o checkout\", \r\n      details: error.message \r\n    });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,kDAAkD;AAClD,iEAAiE;AACjE,MAAM,SAAS,IAAI,sLAAiB,CAAC;IACnC,aAAa,QAAQ,GAAG,CAAC,eAAe;AAC1C;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,qDAAqD;IACrD,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAAuB;IAChE;IAEA,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI;IAEvD,IAAI;QACF,MAAM,aAAa,IAAI,+KAAU,CAAC;QAElC,sCAAsC;QACtC,MAAM,WAAW,MAAM,WAAW,MAAM,CAAC;YACvC,MAAM;gBACJ,6DAA6D;gBAC7D,OAAO,MAAM,GAAG,CAAC,CAAA,OAAQ,CAAC;wBACxB,IAAI,KAAK,EAAE,CAAC,QAAQ;wBACpB,OAAO,KAAK,IAAI;wBAChB,YAAY,OAAO,KAAK,KAAK;wBAC7B,UAAU,OAAO,KAAK,UAAU;wBAChC,aAAa;oBACf,CAAC;gBAED,wDAAwD;gBACxD,OAAO;oBACL,OAAO,SAAS;oBAChB,gBAAgB;wBACd,MAAM;wBACN,QAAQ,IAAI,OAAO,CAAC,OAAO,IAAI,gCAAgC;oBACjE;gBACF;gBAEA,4CAA4C;gBAC5C,WAAW;oBACT,SAAS;oBACT,SAAS;oBACT,SAAS;gBACX;gBAEA,6CAA6C;gBAC7C,aAAa;gBAEb,+DAA+D;gBAC/D,UAAU;oBACR,eAAe,CAAC,OAAO,EAAE,KAAK,GAAG,IAAI;oBACrC,kBAAkB;gBACpB;gBAEA,6CAA6C;gBAC7C,iBAAiB;oBACf,wBAAwB,EAAE;oBAC1B,cAAc;gBAChB;YACF;QACF;QAEA,mDAAmD;QACnD,8DAA8D;QAC9D,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YACnB,IAAI,SAAS,EAAE;YACf,YAAY,SAAS,UAAU;QACjC;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YACnB,OAAO;YACP,SAAS,MAAM,OAAO;QACxB;IACF;AACF"}}]
}