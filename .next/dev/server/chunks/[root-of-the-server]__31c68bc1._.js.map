{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sil/Documents/Reposit%C3%B3rios/paodequeijodaira/src/pages/api/checkout-mp.js"],"sourcesContent":["import { MercadoPagoConfig, Preference } from 'mercadopago';\r\n\r\n// 1. Configuração do Cliente (O Token deve estar no seu .env.local)\r\nconst client = new MercadoPagoConfig({ \r\n  accessToken: process.env.MP_ACCESS_TOKEN \r\n});\r\n\r\nexport default async function handler(req, res) {\r\n  if (req.method !== 'POST') {\r\n    return res.status(405).json({ message: 'Método não permitido' });\r\n  }\r\n\r\n  try {\r\n    const { itens, email, frete } = req.body;\r\n\r\n    // 2. Formatação dos itens para o Mercado Pago\r\n    const itemsMP = itens.map(item => ({\r\n      id: String(item.id),\r\n      title: item.nome,\r\n      unit_price: Number(item.preco),\r\n      quantity: Number(item.quantidade),\r\n      currency_id: 'BRL'\r\n    }));\r\n\r\n    // 3. Adicionar Frete se existir\r\n    if (frete && Number(frete) > 0) {\r\n      itemsMP.push({\r\n        id: 'frete-entrega',\r\n        title: 'Taxa de Entrega',\r\n        unit_price: Number(frete),\r\n        quantity: 1,\r\n        currency_id: 'BRL'\r\n      });\r\n    }\r\n\r\n    const preference = new Preference(client);\r\n\r\n    const response = await preference.create({\r\n      body: {\r\n        items: itemsMP,\r\n        payer: { email: email },\r\n        external_reference: email,\r\n        back_urls: {\r\n          success: `${process.env.NEXT_PUBLIC_SITE_URL}/sucesso`,\r\n          failure: `${process.env.NEXT_PUBLIC_SITE_URL}/erro`,\r\n          pending: `${process.env.NEXT_PUBLIC_SITE_URL}/pendente`,\r\n        },\r\n        auto_return: \"approved\",\r\n        notification_url: `${process.env.NEXT_PUBLIC_SITE_URL}/api/webhook-mp`,\r\n      }\r\n    });\r\n\r\n    res.status(200).json({ init_point: response.init_point });\r\n\r\n  } catch (error) {\r\n    console.error(\"Erro MP:\", error);\r\n    res.status(500).json({ error: \"Erro ao gerar link\", details: error.message });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,oEAAoE;AACpE,MAAM,SAAS,IAAI,sLAAiB,CAAC;IACnC,aAAa,QAAQ,GAAG,CAAC,eAAe;AAC1C;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAAuB;IAChE;IAEA,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,IAAI,IAAI;QAExC,8CAA8C;QAC9C,MAAM,UAAU,MAAM,GAAG,CAAC,CAAA,OAAQ,CAAC;gBACjC,IAAI,OAAO,KAAK,EAAE;gBAClB,OAAO,KAAK,IAAI;gBAChB,YAAY,OAAO,KAAK,KAAK;gBAC7B,UAAU,OAAO,KAAK,UAAU;gBAChC,aAAa;YACf,CAAC;QAED,gCAAgC;QAChC,IAAI,SAAS,OAAO,SAAS,GAAG;YAC9B,QAAQ,IAAI,CAAC;gBACX,IAAI;gBACJ,OAAO;gBACP,YAAY,OAAO;gBACnB,UAAU;gBACV,aAAa;YACf;QACF;QAEA,MAAM,aAAa,IAAI,+KAAU,CAAC;QAElC,MAAM,WAAW,MAAM,WAAW,MAAM,CAAC;YACvC,MAAM;gBACJ,OAAO;gBACP,OAAO;oBAAE,OAAO;gBAAM;gBACtB,oBAAoB;gBACpB,WAAW;oBACT,SAAS,GAAG,QAAQ,GAAG,CAAC,oBAAoB,CAAC,QAAQ,CAAC;oBACtD,SAAS,GAAG,QAAQ,GAAG,CAAC,oBAAoB,CAAC,KAAK,CAAC;oBACnD,SAAS,GAAG,QAAQ,GAAG,CAAC,oBAAoB,CAAC,SAAS,CAAC;gBACzD;gBACA,aAAa;gBACb,kBAAkB,GAAG,QAAQ,GAAG,CAAC,oBAAoB,CAAC,eAAe,CAAC;YACxE;QACF;QAEA,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,YAAY,SAAS,UAAU;QAAC;IAEzD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,YAAY;QAC1B,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;YAAsB,SAAS,MAAM,OAAO;QAAC;IAC7E;AACF"}}]
}